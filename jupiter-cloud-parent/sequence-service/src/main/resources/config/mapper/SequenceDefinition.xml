<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jupiterframework.sequence.model.SequenceDefinition">
	<resultMap id="BaseResultMap" type="com.jupiterframework.sequence.model.SequenceDefinition">
		<id column="tenant_id" property="tenantId" />
		<id column="seq_name" property="seqName" />
		<result column="min_value" property="minValue" />
		<result column="max_value" property="maxValue" />
		<result column="partition_min_value" property="partitionMinValue" />
		<result column="partition_max_value" property="partitionMaxValue" />
		<result column="increase" property="increase" />
		<result column="current_value" property="currentValue" />
		<result column="cycle" property="cycle" />
		<result column="char_length" property="charLength" />
		<result column="prefix" property="prefix" />
		<result column="append_date_format" property="appendDateFormat" />
	</resultMap>

	<sql id="Table_Name">sequence_definition_${extraParameter.tableIndex}</sql>

	<sql id="Base_Column">
		tenant_id,
		seq_name,
		min_value,
		max_value,
		partition_min_value,
		partition_max_value,
		increase,
		current_value,
		cycle,
		char_length,
		prefix,
		append_date_format
	</sql>

	<sql id="Base_Where">
		<trim suffixOverrides="AND">
			<if test="tenantId != null">tenant_id= #{tenantId} AND </if>
			<if test="seqName != null">seq_name= #{seqName} AND </if>
			<if test="minValue != null">min_value= #{minValue} AND </if>
			<if test="maxValue != null">max_value= #{maxValue} AND </if>
			<if test="partitionMinValue != null">partition_min_value= #{partitionMinValue} AND </if>
			<if test="partitionMaxValue != null">partition_max_value= #{partitionMaxValue} AND </if>
			<if test="increase != null">increase= #{increase} AND </if>
			<if test="currentValue != null">current_value= #{currentValue} AND </if>
			<if test="cycle != null">cycle= #{cycle} AND </if>
			<if test="charLength != null">char_length= #{charLength} AND </if>
			<if test="prefix != null">prefix= #{prefix} AND </if>
			<if test="appendDateFormat != null">append_date_format= #{appendDateFormat}</if>
		</trim>
	</sql>

	<sql id="Base_Select">
		SELECT <include refid="Base_Column" />
		FROM <include refid="Table_Name" />
		<where><include refid="Base_Where" /></where>
	</sql>

	<update id="createTable">
		CREATE table <include refid="Table_Name" />(
			tenant_id  varchar(32) NOT NULL ,
			seq_name  varchar(32) NOT NULL ,
			min_value  decimal(19,0) NOT NULL  ,
			max_value  decimal(19,0) NOT NULL ,
			partition_min_value  decimal(19,0) NOT NULL ,
			partition_max_value  decimal(19,0) NOT NULL ,
			increase  int NOT NULL ,
			current_value  decimal(19,0) NOT NULL ,
			cycle  tinyint NOT NULL ,
			char_length  int NULL ,
			prefix  varchar(8) NULL ,
			append_date_format  varchar(17) NULL ,
			PRIMARY KEY (tenant_id, seq_name)
		)
	</update>

	<insert id="insert">
		INSERT INTO <include refid="Table_Name" />
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="tenantId != null">tenant_id,</if>
			<if test="seqName != null">seq_name,</if>
			<if test="minValue != null">min_value,</if>
			<if test="maxValue != null">max_value,</if>
			<if test="partitionMinValue != null">partition_min_value,</if>
			<if test="partitionMaxValue != null">partition_max_value,</if>
			<if test="increase != null">increase,</if>
			<if test="currentValue != null">current_value,</if>
			<if test="cycle != null">cycle,</if>
			<if test="charLength != null">char_length,</if>
			<if test="prefix != null">prefix,</if>
			<if test="appendDateFormat != null">append_date_format,</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="tenantId != null">#{tenantId},</if>
			<if test="seqName != null">#{seqName},</if>
			<if test="minValue != null">#{minValue},</if>
			<if test="maxValue != null">#{maxValue},</if>
			<if test="partitionMinValue != null">#{partitionMinValue},</if>
			<if test="partitionMaxValue != null">#{partitionMaxValue},</if>
			<if test="increase != null">#{increase},</if>
			<if test="currentValue != null">#{currentValue},</if>
			<if test="cycle != null">#{cycle},</if>
			<if test="charLength != null">#{charLength},</if>
			<if test="prefix != null">#{prefix},</if>
			<if test="appendDateFormat != null">#{appendDateFormat},</if>
		</trim>
	</insert>

	<update id="updateByEntity">
		UPDATE <include refid="Table_Name" />
		<set>
			<if test="extraParameter.setParameter.minValue != null">min_value=#{extraParameter.setParameter.minValue},</if>
			<if test="extraParameter.setParameter.maxValue != null">max_value=#{extraParameter.setParameter.maxValue},</if>
			<if test="extraParameter.setParameter.partitionMinValue != null">partition_min_value=#{extraParameter.setParameter.partitionMinValue},</if>
			<if test="extraParameter.setParameter.partitionMaxValue != null">partition_max_value=#{extraParameter.setParameter.partitionMaxValue},</if>
			<if test="extraParameter.setParameter.increase != null">increase=#{extraParameter.setParameter.increase},</if>
			<if test="extraParameter.setParameter.currentValue != null">current_value=#{extraParameter.setParameter.currentValue},</if>
			<if test="extraParameter.setParameter.cycle != null">cycle=#{extraParameter.setParameter.cycle},</if>
			<if test="extraParameter.setParameter.charLength != null">char_length=#{extraParameter.setParameter.charLength},</if>
			<if test="extraParameter.setParameter.prefix != null">prefix=#{extraParameter.setParameter.prefix},</if>
			<if test="extraParameter.setParameter.appendDateFormat != null">append_date_format=#{extraParameter.setParameter.appendDateFormat},</if>
		</set>
		<where>
			<include refid="Base_Where" />
		</where>
	</update>

	<delete id="delete">
		DELETE FROM <include refid="Table_Name" />
		<where><include refid="Base_Where" /></where>
	</delete>

	<select id="count" resultType="int">
		SELECT COUNT(1) FROM <include refid="Table_Name" />
		<where><include refid="Base_Where" /></where>
	</select>

	<select id="selectOne" resultMap="BaseResultMap">
		<include refid="Base_Select" />
	</select>

	<select id="selectList" resultMap="BaseResultMap">
		<include refid="Base_Select" />
	</select>

	<select id="selectForUpdate" resultMap="BaseResultMap" useCache="false">
		<include refid="Base_Select" /> FOR UPDATE
	</select>

</mapper>